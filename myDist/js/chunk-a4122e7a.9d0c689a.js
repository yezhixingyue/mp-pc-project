(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-a4122e7a"],{"33f7":function(e,t,n){"use strict";var a=n("a731");n.n(a).a},"846c":function(e,t,n){"use strict";n.r(t);var a=(n("99af"),n("7db0"),n("4160"),n("d81d"),n("b680"),n("d3b7"),n("ac1f"),n("3ca3"),n("5319"),n("841c"),n("159b"),n("ddb0"),n("2909")),s=(n("96cf"),n("1da1")),i={props:{visible:{type:Boolean,default:!1},openType:{type:String,default:"new"},curEditInfo:{type:Object,default:null}},data:function(){var e=this;return{newAdd:{Consignee:"",Mobile:"",AddressID:"",CustomerID:"",ExpressArea:{RegionalName:"",RegionalID:"",CityName:"",CityID:"",CountyName:"",CountyID:""},AddressDetail:"",HavePosition:!1,IsDefault:!1,Latitude:"",Longitude:""},rules:{Consignee:[{required:!0,message:"请输入收货人姓名",trigger:"blur"}],Mobile:[{validator:function(t,n,a){e.validateCheck(n,e.defineRules.Mobile,a)&&a()},trigger:"blur"}],AddressDetail:[{required:!0,message:"请填写详细地址(不包含省市区)",trigger:"blur"},{min:1,max:60,message:"最多60个字符",trigger:"blur"}],Regional:[{validator:function(t,n,a){e.newAdd.ExpressArea.RegionalID?a():a(new Error("请选择省份"))},trigger:"change"}],City:[{validator:function(t,n,a){e.newAdd.ExpressArea.CityID?a():a(new Error("请选择城市"))},trigger:"change"}],County:[{validator:function(t,n,a){e.newAdd.ExpressArea.CountyID?a():a(new Error("请选择地区"))},trigger:"change"}]},defineRules:{Mobile:[{strategy:"isNotEmpty",errorMsg:"请输入手机号!"},{strategy:"shouldLength:11",errorMsg:"请输入11位手机号码"},{strategy:"isPhone",errorMsg:"手机号码格式不正确"}]},RegionalList:[],CityList:[],CountyList:[],lng:113.625351,lat:34.746303,zoom:14,mapIsLoading:!1,lastSearchWords:"",isMapLoaded:!1,searchOption:{},canClose:!0,mapCenter:[113.625351,34.746303],map:null,initNum:0}},computed:{Mobile:{get:function(){return this.newAdd.Mobile},set:function(e){this.newAdd.Mobile=e.replace(/[^\d.]/g,"")}},title:function(){return"edit"===this.openType?"编辑配送地址":"new"===this.openType?"新增配送地址":"tempAdd"===this.openType?"地图定位":""}},methods:{handleRegionalChange:function(e){var t=this;return Object(s.a)(regeneratorRuntime.mark((function n(){var a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.RegionalList.find((function(t){return t.ID===e})),t.newAdd.ExpressArea.RegionalName=a.Name,t.newAdd.ExpressArea.CityID="",t.newAdd.ExpressArea.CityName="",t.newAdd.ExpressArea.CountyID="",t.newAdd.ExpressArea.CountyName="",t.CityList=[],t.CountyList=[],0!==t.CityList.length&&t.CityList[0].ParentID===e){n.next=13;break}return n.next=11,t.api.getAddressIDList(e);case 11:1e3===(s=n.sent).data.Status&&(t.CityList=s.data.Data);case 13:case"end":return n.stop()}}),n)})))()},handleCityChange:function(e){var t=this;return Object(s.a)(regeneratorRuntime.mark((function n(){var a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.CityList.find((function(t){return t.ID===e})),t.newAdd.ExpressArea.CityName=a.Name,t.newAdd.ExpressArea.CountyID="",t.newAdd.ExpressArea.CountyName="",t.CountyList=[],0!==t.CountyList.length&&t.CountyList[0].ParentID===e){n.next=10;break}return n.next=8,t.api.getAddressIDList(e);case 8:1e3===(s=n.sent).data.Status&&(t.CountyList=s.data.Data);case 10:case"end":return n.stop()}}),n)})))()},handleCountyChange:function(e){var t=this.CountyList.find((function(t){return t.ID===e}));this.newAdd.ExpressArea.CountyName=t.Name},handleClose:function(){this.$emit("changeStatus",!1)},handleSubmit:function(e){var t=this;return Object(s.a)(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("new"!==t.openType){n.next=4;break}t.$refs[e].validate(function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(n){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=9;break}if(t.newAdd.HavePosition){e.next=4;break}return t.messageBox.failSingleError({title:"尚未设置地图定位",msg:"请点击右侧 [ 地图定位 ] 按钮进行设置"}),e.abrupt("return");case 4:return a=JSON.parse(JSON.stringify(t.newAdd)),e.next=7,t.api.getCustomerAddress(a);case 7:1e3===(s=e.sent).data.Status&&t.messageBox.successSingle({title:"地址添加成功",successFunc:function(){t.newAdd.AddressID=s.data.Data,t.$store.commit("common/handleAddOrEditAddressOnStore",[t.newAdd,"add"]),t.handleBeforeDiaClose()}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.next=16;break;case 4:if("tempAdd"!==t.openType){n.next=11;break}t.$emit("changeProps",t.newAdd),t.canClose=!0,t.$message({message:"已定位",type:"success"}),t.handleBeforeDiaClose(!0),n.next=16;break;case 11:return a=JSON.parse(JSON.stringify(t.newAdd)),n.next=14,t.api.getCustomerAddress(a);case 14:1e3===n.sent.data.Status&&t.messageBox.successSingle({title:"地址修改成功",successFunc:function(){t.$store.commit("common/handleAddOrEditAddressOnStore",[t.newAdd,"edit"]),t.handleBeforeDiaClose()}});case 16:case"end":return n.stop()}}),n)})))()},setPositionIndex:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.toFixed(6),s=t.toFixed(6);n&&(this.lng=a,this.lat=s,this.mapCenter=[e,t]),this.newAdd.Latitude=s,this.newAdd.Longitude=a},handleMapClick:function(e){this.setPositionIndex(e.lnglat.lng,e.lnglat.lat)},onSearchResult:function(e){if(this.mapIsLoading=!1,e.length>0){var t=e[0],n=t.lng,a=t.lat;this.setPositionIndex(n,a)}},handleMapLocationClick:function(){var e=this,t=this.newAdd,n=t.AddressDetail,a=t.ExpressArea,s=a.RegionalName,i=a.CityName,r=a.CountyName,o="".concat(s).concat(i).concat(r).concat(n);o!==this.lastSearchWords&&(this.newAdd.HavePosition=!0,this._PlaceSearch.search(o,(function(t,n){if(e.mapIsLoading=!1,n&&n.poiList&&n.poiList.count){var a=n.poiList.pois.map((function(e){var t=e;return t.lat=e.location.lat,t.lng=e.location.lng,t}));e.onSearchResult(a),e.initNum+=1}else if("error"===t||void 0===n.poiList)throw e.messageBox.failSingleError({title:"定位失败",msg:"搜索不到地址，请尝试修改搜索关键词!",successFunc:function(){e.$emit("handleMapSearchError")}}),e.initNum||"new"!==e.openType||(e.newAdd.HavePosition=!1),new Error("定位搜索错误!")})),this.mapIsLoading=!0,this.lastSearchWords=o)},handleDialogOpen:function(){var e=this;return Object(s.a)(regeneratorRuntime.mark((function t(){var n,s,i,r,o,d,l,c,u,p,m,g,A,f,h,C,w,y,D,x,b,v,I,L,E,k,N,R,M,S,P,O,T,_,$,B,H;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.initNum=0,e.lastSearchWords="",e.$nextTick((function(){e.map=new AMap.Map("map-container",{center:[e.lng,e.lat],resizeEnable:!0,zoom:14}),e._PlaceSearch=new AMap.PlaceSearch(e.searchOption),e.marker=new AMap.Marker({position:[e.lng,e.lat],title:"北京"}),e.map.add(e.marker),e.map.on("click",e.handleMapClick),"tempAdd"===e.openType&&e.handleMapLocationClick()})),"edit"!==e.openType){t.next=34;break}if(e.curEditInfo){t.next=6;break}return t.abrupt("return");case 6:if(n=e.curEditInfo,s=n.AddressDetail,i=n.AddressID,r=n.Consignee,o=n.ExpressArea,d=n.CustomerID,l=n.HavePosition,c=n.IsDefault,u=n.Latitude,p=n.Longitude,m=n.Mobile,e.newAdd.Consignee=r,e.newAdd.Mobile=m,e.newAdd.AddressID=i,e.newAdd.CustomerID=d,e.newAdd.AddressDetail=s,e.newAdd.HavePosition=l,e.newAdd.IsDefault=c,e.newAdd.Latitude=u,e.newAdd.Longitude=p,g=o.RegionalName,A=o.RegionalID,f=o.CityName,h=o.CityID,C=o.CountyName,w=o.CountyID,e.newAdd.ExpressArea.RegionalName=g,e.newAdd.ExpressArea.RegionalID=A,e.newAdd.ExpressArea.CityName=f,e.newAdd.ExpressArea.CityID=h,e.newAdd.ExpressArea.CountyName=C,e.newAdd.ExpressArea.CountyID=w,u&&p&&(e.lng=p,e.lat=u,e.mapCenter=[p,u],e.setPositionIndex(+p,+u,!1)),!o){t.next=32;break}return t.next=27,Promise.all([e.api.getAddressIDList(-1),e.api.getAddressIDList(A),e.api.getAddressIDList(h)]);case 27:y=t.sent,D=y.map((function(e){return 1e3===e.data.Status?e.data.Data:[]})),e.RegionalList=Object(a.a)(D[0]),e.CityList=Object(a.a)(D[1]),e.CountyList=Object(a.a)(D[2]);case 32:t.next=65;break;case 34:if("tempAdd"!==e.openType){t.next=57;break}if(e.curEditInfo){t.next=37;break}return t.abrupt("return");case 37:x=e.curEditInfo,b=x.AddressDetail,v=x.isSaved,I=x.Consignee,L=x.ExpressArea,E=x.CustomerID,k=x.HavePosition,N=x.IsDefault,R=x.Latitude,M=x.Longitude,S=x.Mobile,e.newAdd.Consignee=I,e.newAdd.Mobile=S,e.newAdd.isSaved=v,e.newAdd.CustomerID=E,e.newAdd.AddressDetail=b,e.newAdd.HavePosition=k,e.newAdd.IsDefault=N,e.newAdd.Latitude=R,e.newAdd.Longitude=M,P=L.RegionalName,O=L.RegionalID,T=L.CityName,_=L.CityID,$=L.CountyName,B=L.CountyID,e.newAdd.ExpressArea.RegionalName=P,e.newAdd.ExpressArea.RegionalID=O,e.newAdd.ExpressArea.CityName=T,e.newAdd.ExpressArea.CityID=_,e.newAdd.ExpressArea.CountyName=$,e.newAdd.ExpressArea.CountyID=B,e.canClose=!1,t.next=65;break;case 57:if(e.CityList=[],e.CountyList=[],!(e.RegionalList.length>0)){t.next=61;break}return t.abrupt("return");case 61:return t.next=63,e.api.getAddressIDList(-1);case 63:1e3===(H=t.sent).data.Status&&(e.RegionalList=H.data.Data);case 65:case"end":return t.stop()}}),t)})))()},handleBeforeDiaClose:function(){"tempAdd"!==this.openType||this.canClose?(this.newAdd={Consignee:"",Mobile:"",AddressID:"",CustomerID:"",ExpressArea:{RegionalName:"",RegionalID:"",CityName:"",CityID:"",CountyName:"",CountyID:""},AddressDetail:"",HavePosition:!1,IsDefault:!1,Latitude:"",Longitude:""},this.$refs.ruleForm.resetFields(),this.handleClose()):this.messageBox.failSingleError({title:"新增地址需要定位",msg:"请在地图中保存收货地址定位!"})}},watch:{visible:function(e){e&&this.handleDialogOpen()},mapCenter:function(){this.map&&this.map.setCenter(this.mapCenter),this.marker&&this.marker.setPosition(this.mapCenter)}},mounted:function(){var e=this,t="https://webapi.amap.com/maps?v=1.4.15&key=09966c2b866f9783b49969af19102d91&plugin=AMap.PlaceSearch&callback=initMap",n=!0;if(document.getElementsByTagName("script").forEach((function(a){n&&a.src===t&&(n=!1,e.isMapLoaded=!0)})),n){window.initMap=function(){e.isMapLoaded=!0};var a=document.createElement("script");a.charset="utf-8",a.src=t,document.head.appendChild(a)}}},r=(n("33f7"),n("2877")),o=Object(r.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.visible?n("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{visible:e.visible,top:"7vh",width:"1000px","destroy-on-close":"","before-close":e.handleBeforeDiaClose,"custom-class":"set-craft-dia mp-pc-address-map-comp-wrap"}},[n("header",{attrs:{slot:"title"},slot:"title"},[n("i",{staticClass:"iconfont icon-shezhi is-primary-blue"}),n("span",[e._v(e._s(e.title))])]),n("ul",{staticClass:"change-add-dia-content",class:"tempAdd"===e.openType?"tempAdd":""},[n("li",[n("section",{directives:[{name:"show",rawName:"v-show",value:"tempAdd"!==e.openType,expression:"openType !== 'tempAdd'"}]},[n("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.newAdd,rules:e.rules,"label-width":"0px"}},[n("header",[n("div",[n("span",{staticClass:"title"},[e._v("收货人：")]),n("el-form-item",{attrs:{prop:"Consignee"}},[n("el-input",{attrs:{placeholder:"收货人姓名"},model:{value:e.newAdd.Consignee,callback:function(t){e.$set(e.newAdd,"Consignee","string"==typeof t?t.trim():t)},expression:"newAdd.Consignee"}})],1)],1),n("div",[n("span",{staticClass:"title"},[e._v("手机号：")]),n("el-form-item",{attrs:{prop:"Mobile"}},[n("el-input",{staticClass:"phone-box",attrs:{"el-input":"",placeholder:"手机号"},model:{value:e.Mobile,callback:function(t){e.Mobile="string"==typeof t?t.trim():t},expression:"Mobile"}})],1)],1)]),n("div",{staticClass:"content"},[n("div",{staticClass:"add-1"},[n("span",{staticClass:"title"},[e._v("收货地址：")]),n("el-form-item",{attrs:{prop:"Regional"}},[n("el-select",{on:{change:e.handleRegionalChange},model:{value:e.newAdd.ExpressArea.RegionalID,callback:function(t){e.$set(e.newAdd.ExpressArea,"RegionalID",t)},expression:"newAdd.ExpressArea.RegionalID"}},e._l(e.RegionalList,(function(e){return n("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})})),1)],1),n("el-form-item",{attrs:{prop:"City"}},[n("el-select",{attrs:{disabled:0===e.CityList.length},on:{change:e.handleCityChange},model:{value:e.newAdd.ExpressArea.CityID,callback:function(t){e.$set(e.newAdd.ExpressArea,"CityID",t)},expression:"newAdd.ExpressArea.CityID"}},e._l(e.CityList,(function(e){return n("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})})),1)],1),n("el-form-item",{attrs:{prop:"County"}},[n("el-select",{attrs:{disabled:0===e.CountyList.length},on:{change:e.handleCountyChange},model:{value:e.newAdd.ExpressArea.CountyID,callback:function(t){e.$set(e.newAdd.ExpressArea,"CountyID",t)},expression:"newAdd.ExpressArea.CountyID"}},e._l(e.CountyList,(function(e){return n("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})})),1)],1)],1),n("div",{staticClass:"add-2"},[n("el-form-item",{attrs:{prop:"AddressDetail"}},[n("el-input",{attrs:{maxlength:"60","show-word-limit":"",placeholder:"详细地址 (不包含省市区)"},model:{value:e.newAdd.AddressDetail,callback:function(t){e.$set(e.newAdd,"AddressDetail","string"==typeof t?t.trim():t)},expression:"newAdd.AddressDetail"}})],1),n("el-button",{staticClass:"map-location-btn",attrs:{type:"primary",disabled:!e.newAdd.ExpressArea.CountyID},on:{click:e.handleMapLocationClick}},[e._v("地图定位")])],1)])])],1)]),n("li",{staticClass:"map-wrap"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.newAdd.HavePosition||"tempAdd"===e.openType,expression:"newAdd.HavePosition || openType==='tempAdd'"},{name:"loading",rawName:"v-loading",value:e.mapIsLoading,expression:"mapIsLoading"}],staticClass:"map-content",attrs:{id:"map-container"}})]),"tempAdd"===e.openType?n("li",[n("span",{staticClass:"is-gray is-font-13"},[e._v("使用新增地址时，需要在地图上定位准确的地址坐标 !")])]):e._e()]),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("ruleForm")}}},[e._v("确定")]),"tempAdd"!==e.openType?n("el-button",{on:{click:e.handleBeforeDiaClose}},[e._v("取消")]):e._e()],1)]):e._e()}),[],!1,null,null,null);t.default=o.exports},a731:function(e,t,n){}}]);